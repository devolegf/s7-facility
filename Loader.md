FB1/DB1 ("Loader"/"DB\_Loader") — системные блоки, реализующие идеологию построения программы из тиражируемых объектов. Дополнительное описание смотрите в документации по этим блокам.

Что для этого нужно?

  1. Создать от одной до четырех FB с одинаковой структурой данных — это обработчики объекта.
  1. Создать DB, в котором будет содержаться массив, внутренняя структура которого содержит структуры FB обработчиков класса объектов (Структуры FB могут пересекаться или даже полностью повторять друг друг друга). Самый простой путь — создать четыре FB с одинаковой структурой, создать временный DI для одного из FB обработчиков объектов и скопировать структуру из него, после чего удалить этот DI.
  1. Заполнить DB1 следующими данными:
    * Общие параметры
      * Classes\_Quantity — количество классов объектов, которые требуются обработать. В идеале совпадает с размером массива в DB1.
      * Current\_Class — текущий обрабатываемый класс. Постоянно генерируется в процессе работы и не требует какой-либо инициализации.
      * Current\_Item — текущий обрабатываемый объект класса. Постоянно генерируется в процессе работы и не требует какой-либо инициализации.
    * Параметры для каждого класса:
      * DB\_No — номер DB с объектами класса.
      * Item\_Lengh — длина одного объекта класса в байтах.
      * Items\_Start — смещение первого объекта класса в байтах от начала DB. Таким образом объекты класса могут начинаться не с начала DB.
      * Items\_Quantity — количество объектов класса в DB.
      * FB\_1.FB\_No — FB\_4.FB\_No — номера FB обработчиков класса.
      * FB\_1.FB\_Shift — FB\_4.FB\_Shift — смещение в байтах от начала объекта для вызова FB обработчиков класса. ВНИМАНИЕ! Задается как DWORD, т. е. в HEX!
      * MAX, Circle\_20ms и т.д. - скорость, с которой будут вызываться FB обработчиков класса. Важно для объектов, которым необходимо задавать скорость обработки.